<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Leaflet Map with Layer Control and Z-Index Fix</title>
    <!-- Leaflet CSS -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <!-- Leaflet JavaScript -->
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <style>
        /* Ensure the map covers the entire viewport */
        html, body {
            margin: 0;
            padding: 0;
            width: 100%;
            height: 100%;
            font-family: Inter, sans-serif;
        }
        #map {
            width: 100%;
            height: 100%;
        }
        /* Style the Leaflet control container for better aesthetics */
        .leaflet-control-layers-expanded {
            border-radius: 8px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }
    </style>
</head>
<body>
    <div id="map"></div>

    <script>
        // Initialize map centered on continental US
        // We initialize the map with no layers added yet, as L.control.layers will handle the initial display.
        const map = L.map('map').setView([39.833, -98.583], 4);

        // --- 1. Define Base Layers ---
        // Base layers are tile layers that typically cover the whole map.
        const osm = L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            maxZoom: 19,
            attribution: '&copy; OpenStreetMap contributors',
            zIndex: 1 // Base layers should have the lowest z-index
        });

        const esri = L.tileLayer('https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}', {
            maxZoom: 19,
            attribution: 'Tiles &copy; Esri &mdash; Source: Esri, Earthstar Geographics',
            zIndex: 1
        });
        
        // Add the default base layer to the map on startup
        osm.addTo(map);

        // --- 2. Define Overlay Layers (WMS and Tile Layers) ---
        // Overlays sit on top of the base layer. We use high zIndex values to ensure visibility.

        // WMS Layer (topp:states) - Set zIndex higher than base maps (e.g., 10)
        const wmsLayer = L.tileLayer.wms('https://ahocevar.com/geoserver/wms', {
            layers: 'topp:states',
            format: 'image/png',
            transparent: true,
            attribution: 'WMS from GeoServer',
            zIndex: 10 
        });

        // North American Water Features Layer (USGS National Map) - Set zIndex higher (e.g., 11)
        const waterLayer = L.tileLayer.wms('https://basemap.nationalmap.gov/arcgis/services/USGSHydroCached/MapServer/WMSServer?', {
            layers: '0',
            format: 'image/png',
            transparent: true,
            attribution: 'USGS National Map Water Features',
            zIndex: 11
        });
        
        // NEW: Rail Lines Layer (ESRI World Transportation)
        const railLayer = L.tileLayer('https://server.arcgisonline.com/ArcGIS/rest/services/Reference/World_Transportation/MapServer/tile/{z}/{y}/{x}', {
            maxZoom: 19,
            attribution: 'Source: Esri, DeLorme, NAVTEQ, etc.',
            zIndex: 12, // Highest zIndex to ensure it appears over all other map layers
            opacity: 0.8 // Optional: make it slightly transparent
        });
        
        // --- 3. Create Layer Control Objects ---
        
        // Object containing base layers (only one can be active at a time)
        const baseMaps = {
            "OpenStreetMap": osm,
            "ESRI Imagery": esri
        };

        // Object containing overlay layers (can be toggled on/off independently)
        const overlayMaps = {
            "WMS GeoServer States": wmsLayer,
            "USGS Water Features": waterLayer,
            "ESRI Rail Lines": railLayer // New layer added here
        };

        // --- 4. Add the Layer Control to the Map ---
        L.control.layers(baseMaps, overlayMaps, {
            collapsed: false // Keep the control expanded by default for easy viewing
        }).addTo(map);

    </script>
</body>
</html>
